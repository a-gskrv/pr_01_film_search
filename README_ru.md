# Film Search Service

Сервис поиска фильмов по базе данных MySQL (Sakila) с несколькими пользовательскими интерфейсами и общей бизнес-логикой.

Проект демонстрирует архитектурный подход с чётким разделением ответственности между слоями и возможностью подключения новых интерфейсов без дублирования SQL или бизнес-логики.

---

## Возможности

- Поиск фильмов:
  - по ключевому слову
  - по жанру
  - по жанру и диапазону годов
- Пагинация результатов
- Логирование поисковых запросов в MongoDB
- Несколько интерфейсов поверх одного ядра:
  - CLI
  - Web (FastAPI)

---

## Архитектура

Проект построен по слоистой архитектуре:

```text
app/
├── core/
│   ├── repositories/   # Доступ к данным (MySQL, MongoDB)
│   ├── exceptions.py   # Пользовательские исключения для MySQL и MongoDB
│   ├── services.py     # Бизнес-логика приложения
│   └── db/             # Подключения и конфигурация БД
│
├── interfaces/
│   ├── cli/            # CLI интерфейс
│   ├── fastapi/        # Web интерфейс (FastAPI)
│   │
│   └── main.py         # Точка входа и выбор интерфейса
│
└── tests/              # Тесты (планируются)
```


### Ключевые принципы

- **Repository layer**
  - Содержит только SQL / MongoDB-запросы
  - Не содержит бизнес-логики
- **Service layer**
  - Единая точка бизнес-логики
  - Используется всеми интерфейсами
  - Реализует пагинацию и защиту от некорректных параметров
- **Interface layer**
  - Не содержит SQL
  - Работает только через сервисы
  - Отвечает за ввод/вывод и состояние UI

---

## Интерфейсы

### CLI
Интерактивный консольный интерфейс с меню и поддержкой пагинации.  
Предназначен для быстрого доступа и отладки.

### Web (FastAPI)
Web-интерфейс на базе FastAPI и Jinja2:
- HTML-страницы
- POST → redirect → GET
- Серверная пагинация
- Отсутствие глобального состояния

---

## Логирование

Поисковые запросы логируются в MongoDB:
- тип поиска
- параметры запроса
- количество найденных результатов
- временная метка

Логирование является **необязательным**: при недоступности MongoDB основной функционал сервиса продолжает работать.

---

## Требования

- Python 3.10+ (Протестировано на Python 3.13)
- MySQL (схема Sakila)
- MongoDB (для логов)

---

## Установка и запуск

```bash
git clone https://github.com/a-gskrv/pr_01_film_search.git
cd pr_01_film_search
pip install -r requirements.txt
```

Настройте параметры подключения к БД в конфигурации проекта.

CLI
```bash
python -m app.interfaces.cli.main
```

Web (FastAPI)
```bash
uvicorn app.interfaces.fastapi.main:app --reload
```

## Статус проекта

Проект находится в стабильном состоянии и готов к демонстрации:
- реализованы основные сценарии поиска
- интерфейсы используют общее ядро
- архитектура допускает расширение без переработки существующего кода

## Лицензия
MIT
